import{f as N,h as B,x as a,H as F,c as d,j as v,F as R,e as s,I as V,l as x,m as w,J as k,k as y,A as T,T as L,K as Z,L as D,M as K,p as O,b as U,o as m,N as j,_ as P,u as H,z as M,C as J,D as Y,n as G}from"./index.89391bee.js";import{T as A}from"./TextInput.3da0caf6.js";var z={},Q=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;z.validate=function(e){if(!e||e.length>254)return!1;var f=Q.test(e);if(!f)return!1;var r=e.split("@");if(r[0].length>64)return!1;var o=r[1].split(".");return!o.some(function(n){return n.length>63})};const $=e=>(O("data-v-99653806"),e=e(),U(),e),W=["onSubmit","onKeyup"],X=$(()=>s("h2",null,"Under The Radar",-1)),ee={class:"lp-email-text"},te={class:"lp-input-area"},se={key:0,class:"lp-error utr-text-caption"},oe={key:1,class:"lp-error"},ae={class:"lp-button-row"},le={class:"lp-verification-text"},re=$(()=>s("span",null,"An email with your verification code has been sent to",-1)),ne={class:"lp-email"},ue={class:"lp-input-area"},ie={key:0,class:"lp-error"},ce={key:1,class:"lp-error"},de={class:"lp-no-code-text"},ve={class:"lp-button-row"},me=N({__name:"LoginPanel",props:{email:null,codeRequested:{type:Boolean},isBusy:{type:Boolean},submissionError:null,requestError:null},emits:["requestCode","submitCode"],setup(e,{emit:f}){var I;const r=e,o=3,n=B(()=>({type:"submit",justifyContent:"center",icon:"chevron-right",color:"var(--utr-green)",hoverColor:"var(--utr-green-light)"})),u=B(()=>({justifyContent:"center",textClass:"lp-text-button"})),_=a(""),t=a((I=r.email)!=null?I:""),l=a(""),h=a(!1),i=a(r.codeRequested?"enter-code":"enter-email");async function C(E=!1){if(f("requestCode",t.value),i.value="enter-code",E){h.value=!0;try{await K(o*1e3)}finally{h.value=!1}}}function q(){f("submitCode",t.value,_.value)}function p(){i.value=="enter-email"?C(!1):q()}function b(){console.log("onEscape"),i.value=="enter-code"&&(i.value="enter-email")}F(t,E=>{z.validate(E)?l.value="":l.value="Please enter a valid email address"},{immediate:!0});const S=B(()=>!!(t.value&&!l.value));return(E,c)=>(m(),d("form",{class:"login-panel",onSubmit:Z(p,["prevent"]),onKeyup:D(b,["esc"])},[v(j,{height:"128px","large-logo":!0}),X,i.value=="enter-email"?(m(),d(R,{key:0},[s("div",ee,[V(" Enter your email to log in "),s("div",te,[v(A,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=g=>t.value=g),class:"utr-text-body1 lp-control",autofocus:"",placeholder:"yours@example.com"},null,8,["modelValue"]),l.value?(m(),d("div",se,x(l.value),1)):w("",!0),e.requestError?(m(),d("div",oe,x(e.requestError),1)):w("",!0)])]),s("div",ae,[v(T,k({class:"lp-control",label:"CONTINUE",disabled:!y(S)},y(n)),null,16,["disabled"])])],64)):(m(),d(R,{key:1},[s("div",le,[re,s("div",ne,x(t.value),1),s("div",ue,[v(A,{modelValue:_.value,"onUpdate:modelValue":c[1]||(c[1]=g=>_.value=g),class:"lp-input-code",autofocus:"",placeholder:"000000",size:"6"},null,8,["modelValue"]),e.requestError?(m(),d("div",ie,x(e.requestError),1)):w("",!0),e.submissionError?(m(),d("div",ce,x(e.submissionError),1)):w("",!0)]),s("div",de,[V(" Didn't receive code? "),v(L,k({label:"Request again",disabled:e.isBusy||h.value},y(u),{onClick:c[2]||(c[2]=g=>C(!0))}),null,16,["disabled"]),V(". ")])]),s("div",ve,[v(T,k({class:"lp-control",label:"VERIFY",disabled:e.isBusy},y(n)),null,16,["disabled"])]),s("span",null,[V("Not your email? "),v(L,k({label:"Click here."},y(u),{onClick:c[3]||(c[3]=g=>i.value="enter-email")}),null,16)])],64))],40,W))}});const pe=P(me,[["__scopeId","data-v-99653806"]]),fe={class:"login-view"},_e=N({__name:"LoginView",setup(e){var q;G(p=>({"2fe669ab":y(C)}));const f=H(),r=J(),o=Y(),n=a((q=o.email.value)!=null?q:""),u=a(!1),_=a(!1),t=a(""),l=a("");M(()=>{o.isLoggedIn.value?r.push(o.getRouterTargetForHomeOrLoginIfNeeded()):n.value&&h(n.value)});async function h(p){_.value=!0,t.value="";try{u.value=!0,await o.startPasswordlessLogin(p)}catch{t.value="Failed to send code, please check your email address is correct."}finally{u.value=!1}}async function i(p,b){l.value="";try{u.value=!0,await o.submitOTP(b,p),r.push(o.getRouterTargetForHomeOrLoginIfNeeded())}catch{l.value="An error occurred while submitting the code"}finally{u.value=!1}}const C=B(()=>f.breakpoint==="mobile"?"1rem 0.5rem":"2rem");return(p,b)=>(m(),d("div",fe,[v(pe,{email:n.value,"code-requested":_.value,"is-busy":u.value,"submission-error":l.value,"request-error":t.value,onSubmitCode:i,onRequestCode:h},null,8,["email","code-requested","is-busy","submission-error","request-error"])]))}});const be=P(_e,[["__scopeId","data-v-500fa918"]]);export{be as default};
