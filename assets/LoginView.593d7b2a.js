import{f as k,h as V,x as r,z as $,H as Z,I as D,k as y,c,J as M,o as d,_ as B,K as O,j as f,F as L,e as n,L as E,l as x,m as I,M as R,A,T as P,N as U,O as K,P as j,p as H,b as J,Q,u as Y,C as G,D as W,n as X}from"./index.7e82a474.js";var z={},ee=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;z.validate=function(e){if(!e||e.length>254)return!1;var v=ee.test(e);if(!v)return!1;var a=e.split("@");if(a[0].length>64)return!1;var t=a[1].split(".");return!t.some(function(l){return l.length>63})};const te=["autofocus"],se=k({__name:"TextInput",props:{modelValue:null,autofocus:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:v}){const a=e,t=V({get(){return a.modelValue},set(s){v("update:modelValue",s)}}),l=r();return $(()=>{var s;a.autofocus&&((s=l.value)==null||s.focus())}),(s,u)=>Z((d(),c("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":u[0]||(u[0]=o=>M(t)?t.value=o:null),class:"text-input",autofocus:e.autofocus},null,8,te)),[[D,y(t)]])}});const N=B(se,[["__scopeId","data-v-7c42df3e"]]),F=e=>(H("data-v-99653806"),e=e(),J(),e),oe=["onSubmit","onKeyup"],ae=F(()=>n("h2",null,"Under The Radar",-1)),le={class:"lp-email-text"},ne={class:"lp-input-area"},re={key:0,class:"lp-error utr-text-caption"},ue={key:1,class:"lp-error"},ie={class:"lp-button-row"},ce={class:"lp-verification-text"},de=F(()=>n("span",null,"An email with your verification code has been sent to",-1)),ve={class:"lp-email"},pe={class:"lp-input-area"},me={key:0,class:"lp-error"},fe={key:1,class:"lp-error"},_e={class:"lp-no-code-text"},ye={class:"lp-button-row"},he=k({__name:"LoginPanel",props:{email:null,codeRequested:{type:Boolean},isBusy:{type:Boolean},submissionError:null,requestError:null},emits:["requestCode","submitCode"],setup(e,{emit:v}){var S;const a=e,t=3,l=V(()=>({type:"submit",justifyContent:"center",icon:"chevron-right",color:"var(--utr-green)",hoverColor:"var(--utr-green-light)"})),s=V(()=>({justifyContent:"center",textClass:"lp-text-button"})),u=r(""),o=r((S=a.email)!=null?S:""),i=r(""),h=r(!1),p=r(a.codeRequested?"enter-code":"enter-email");async function C(w=!1){if(v("requestCode",o.value),p.value="enter-code",w){h.value=!0;try{await j(t*1e3)}finally{h.value=!1}}}function q(){v("submitCode",o.value,u.value)}function _(){p.value=="enter-email"?C(!1):q()}function g(){console.log("onEscape"),p.value=="enter-code"&&(p.value="enter-email")}O(o,w=>{z.validate(w)?i.value="":i.value="Please enter a valid email address"},{immediate:!0});const T=V(()=>!!(o.value&&!i.value));return(w,m)=>(d(),c("form",{class:"login-panel",onSubmit:U(_,["prevent"]),onKeyup:K(g,["esc"])},[f(Q,{height:"128px","large-logo":!0}),ae,p.value=="enter-email"?(d(),c(L,{key:0},[n("div",le,[E(" Enter your email to log in "),n("div",ne,[f(N,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=b=>o.value=b),class:"utr-text-body1 lp-control",autofocus:"",placeholder:"yours@example.com"},null,8,["modelValue"]),i.value?(d(),c("div",re,x(i.value),1)):I("",!0),e.requestError?(d(),c("div",ue,x(e.requestError),1)):I("",!0)])]),n("div",ie,[f(A,R({class:"lp-control",label:"CONTINUE",disabled:!y(T)},y(l)),null,16,["disabled"])])],64)):(d(),c(L,{key:1},[n("div",ce,[de,n("div",ve,x(o.value),1),n("div",pe,[f(N,{modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=b=>u.value=b),class:"lp-input-code",autofocus:"",placeholder:"000000",size:"6"},null,8,["modelValue"]),e.requestError?(d(),c("div",me,x(e.requestError),1)):I("",!0),e.submissionError?(d(),c("div",fe,x(e.submissionError),1)):I("",!0)]),n("div",_e,[E(" Didn't receive code? "),f(P,R({label:"Request again",disabled:e.isBusy||h.value},y(s),{onClick:m[2]||(m[2]=b=>C(!0))}),null,16,["disabled"]),E(". ")])]),n("div",ye,[f(A,R({class:"lp-control",label:"VERIFY",disabled:e.isBusy},y(l)),null,16,["disabled"])]),n("span",null,[E("Not your email? "),f(P,R({label:"Click here."},y(s),{onClick:m[3]||(m[3]=b=>p.value="enter-email")}),null,16)])],64))],40,oe))}});const ge=B(he,[["__scopeId","data-v-99653806"]]),be={class:"login-view"},xe=k({__name:"LoginView",setup(e){var q;X(_=>({"2fe669ab":y(C)}));const v=Y(),a=G(),t=W(),l=r((q=t.email.value)!=null?q:""),s=r(!1),u=r(!1),o=r(""),i=r("");$(()=>{t.isLoggedIn.value?a.push(t.getRouterTargetForHomeOrLoginIfNeeded()):l.value&&h(l.value)});async function h(_){u.value=!0,o.value="";try{s.value=!0,await t.startPasswordlessLogin(_)}catch{o.value="Failed to send code, please check your email address is correct."}finally{s.value=!1}}async function p(_,g){i.value="";try{s.value=!0,await t.submitOTP(g,_),a.push(t.getRouterTargetForHomeOrLoginIfNeeded())}catch{i.value="An error occurred while submitting the code"}finally{s.value=!1}}const C=V(()=>v.breakpoint==="mobile"?"1rem 0.5rem":"2rem");return(_,g)=>(d(),c("div",be,[f(ge,{email:l.value,"code-requested":u.value,"is-busy":s.value,"submission-error":i.value,"request-error":o.value,onSubmitCode:p,onRequestCode:h},null,8,["email","code-requested","is-busy","submission-error","request-error"])]))}});const Ce=B(xe,[["__scopeId","data-v-500fa918"]]);export{Ce as default};
