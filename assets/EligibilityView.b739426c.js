import{l as V,_ as A,c as H,s as $}from"./surveyStorage.04dc13e3.js";import{s as W}from"./surveyExampleBase.d113807f.js";import{u as U}from"./surveyStore.32701b01.js";import{m as z,r as u,V as j,_ as G,k as c,b as q,p as J,i as K,f as X,d as Q,x as Z,c as v,y as ee,o as te,z as y,u as S,J as ae,j as ne,W as oe,X as ie,l as se}from"./index.1d7e6142.js";import{a as re,u as ce,O as le,g as ue,b as de,p as pe,c as me,d as ge}from"./pcmServiceApi.d1a7f3de.js";import{u as Y}from"./storeHelpers.4b307abb.js";const ve={name:"ELY1",type:"text",isRequired:!0,title:"How old are you?",inputType:"number",step:1},ye={name:"qELY1_valid",expression:"{ELY1} >= 18"},fe={name:"ELY2",type:"radiogroup",isRequired:!0,title:"How would you describe your gender?",choices:[{text:"Male",value:0},{text:"Female",value:1},{text:"Non-binary",value:2},{text:"I use a different term",value:3}]},_e={name:"qELY2_valid",expression:"{ELY2} == 0"},he={name:"ELY3",type:"radiogroup",isRequired:!0,title:"How do you rate your English ability?",choices:[{text:"Basic",value:0},{text:"Advanced",value:1},{text:"Fluent/Native Speaker",value:2}]},xe={name:"qELY3_valid",expression:"{ELY3} > 0"},Ee={name:"ELY4",type:"radiogroup",isRequired:!0,title:"Are you currently living in Australia?",choices:[{text:"No",value:0},{text:"Yes",value:1}]},Le={name:"qELY4_valid",expression:"{ELY4} > 0"},Se={name:"ELY5",type:"radiogroup",isRequired:!0,title:"Have you thought of dying or hurting yourselves in the past six months?",choices:[{text:"Not at all",value:0},{text:"Several days",value:1},{text:"More than half the days",value:2},{text:"Nearly every day",value:3}]},Ye={name:"qELY5_valid",expression:"{ELY5} > 0"},qe={name:"ELY6",type:"radiogroup",isRequired:!0,title:"Have you seen a counsellor, psychologist, psychiatrist or other mental health professional, or General Practitioner for a mental health problem in the past six months?",choices:[{text:"No",value:0},{text:"Yes",value:1},{text:"Don't know",value:2}]},Ce={name:"qELY6_valid",expression:"{ELY6} == 0"},be={name:"description",type:"html",html:'<div class="utr-html-section"><h2>By providing your contact details, an account will be created for you, if you are eligible for the study.</h2><p>Your account will provide you with access to the Under the Radar study surveys, and periodic email notifications will be sent when surveys are available.</div>'},we={name:"preferredName",type:"text",isRequired:!0,title:"What is your preferred name?",inputType:"text",maxLength:128},Pe={name:"email",type:"text",isRequired:!0,title:"What is your email address?",inputType:"email",maxLength:128},Ie={...W,pages:[{name:"Under the Radar",elements:[ve,fe,he,Ee,Se,qe]},{name:"Under the Radar",elements:[be,we,Pe],visibleIf:"{__needContactPage} || ({eligible_for_study})"}],calculatedValues:[ye,_e,xe,Le,Ye,Ce,{name:"eligible_for_study",expression:"{qELY1_valid} && {qELY2_valid} && {qELY3_valid} && {qELY4_valid} && {qELY5_valid} && {qELY6_valid}",includeIntoResult:!0}]},Re=z("experiment",()=>{const n=u(null),a=o=>{n.value=o},l=()=>{n.value=null},i=Y(j),s=Y(re);return{setExperimentId:a,clearExperimentId:l,getESExperimentCached:i.cacheFn,getPCMExperimentCached:s.cacheFn}});const ke={},De=n=>(J("data-v-9ff2ffc3"),n=n(),K(),n),Me={class:"processing"},Te=De(()=>X("h4",{class:"utr-text-h4"},"Processing. Please wait...",-1)),Fe=[Te];function Ne(n,a){return c(),q("div",Me,Fe)}const Be=G(ke,[["render",Ne],["__scopeId","data-v-9ff2ffc3"]]),Oe={ref:"container",class:"eligibility-view"},ze=Q({__name:"EligibilityView",props:{experimentId:null},setup(n){const a=n,{loginWithRedirect:l}=se(),i=U(),s=Z(),o=ce(),C=Re(),f=ne(),_=u(),d=u(),h=u(),b=v(()=>Ie),p=v(()=>`eligibility:${a.experimentId}`),w=v(()=>i.processing);ee(()=>{const e=V(p.value);h.value=e.oldData}),te(async()=>{if(!o.acceptStudy){const e=a.experimentId?`/consent/${a.experimentId}`:"/consent-test";f.push({path:e})}try{a.experimentId&&await C.getPCMExperimentCached(a.experimentId)}catch(e){console.error(e),f.push({path:"/error-page"})}});function P(e){return!!e.eligible_for_study}function I(e){return e.ELY1>=18}function x(e){const t=e.email;if(t==null)return null;if(typeof t!="string")throw new Error("email is not a string");return t}function m(e){i.setSurveyCompleted(!0),d.value=e,_.value&&(_.value.scrollTop=0)}async function R(e){i.setProcessing(!0);try{const t=x(e),r=await k(e);m(r),t&&await l({appState:{target:"/user-home"},authorizationParams:{screen_hint:"signup",login_hint:t}})}catch(t){t instanceof oe?m("existing account"):m("error")}finally{i.setProcessing(!1),H(p.value)}}async function k(e){const t=P(e);if(!I(e))return"ineligible";const r={...e,accept_data_sharing:o.acceptDataSharing,accept_future_contact:o.acceptFutureContact,request_feedback:o.requestFeedback,consent:o.acceptStudy},N=await ue(a.experimentId),B=await de(a.experimentId);let E=await pe(a.experimentId,N.id,r);if(!E)return"no consent";const L=E.participantCandidateMappingId,g=x(e);if(await me(L,B.id,g,t,e),!t||!g)return"ineligible";const O=await ie(g);return await ge(L,O.id),"signed up"}function D(e){i.setSurveyCompleted(!1),s.setPageCount(e.pageCount),s.setPageTitle(e.currentPage.name);const t=o.requestFeedback||o.acceptFutureContact;e.setVariable("__needContactPage",t)}function M(e,t){s.setPageIndex(e),s.setPageTitle(t)}function T(e,t){const r={...e};delete r.eligible_for_study,$(p.value,r,t)}function F(){l({appState:{target:"/user-home"}})}return(e,t)=>(c(),q("div",Oe,[d.value?(c(),y(le,{key:1,"completion-state":d.value,onOnLogin:F},null,8,["completion-state"])):(c(),y(A,{key:0,"survey-data":S(b),"initial-state":h.value,onOnComplete:R,onOnLoaded:D,onOnPageChanged:M,onOnPartialSend:T},null,8,["survey-data","initial-state"])),S(w)?(c(),y(Be,{key:2})):ae("",!0)],512))}});export{ze as default};
