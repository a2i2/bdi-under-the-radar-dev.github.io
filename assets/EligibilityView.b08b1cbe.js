import{l as A,_ as V,c as $,s as U}from"./surveyStorage.7e799426.js";import{s as W}from"./surveyExampleBase.55db71c1.js";import{u as K}from"./surveyStore.0798320b.js";import{w as j,l as u,W as z,_ as G,o as c,c as q,p as X,a as J,b as Q,d as Z,m as ee,e as v,D as te,n as ae,q as ne,k as y,g as S,j as oe,s as se,X as ie,Y as re,v as ce}from"./index.88bd44bd.js";import{a as le,u as ue,O as de,g as pe,b as me,p as ge,c as ve,d as ye}from"./pcmServiceApi.48cbb3e7.js";import{u as Y}from"./storeHelpers.4a538daf.js";const fe={name:"ELY1",type:"text",isRequired:!0,title:"How old are you?",inputType:"number",step:1},he={name:"qELY1_valid",expression:"{ELY1} >= 18"},_e={name:"ELY2",type:"radiogroup",isRequired:!0,title:"How would you describe your gender?",choices:[{text:"Male",value:0},{text:"Female",value:1},{text:"Non-binary",value:2},{text:"I use a different term",value:3}]},xe={name:"qELY2_valid",expression:"{ELY2} == 0"},Ee={name:"ELY3",type:"radiogroup",isRequired:!0,title:"How do you rate your English ability?",choices:[{text:"Basic",value:0},{text:"Advanced",value:1},{text:"Fluent/Native Speaker",value:2}]},Le={name:"qELY3_valid",expression:"{ELY3} > 0"},Se={name:"ELY4",type:"radiogroup",isRequired:!0,title:"Are you currently living in Australia?",choices:[{text:"No",value:0},{text:"Yes",value:1}]},Ye={name:"qELY4_valid",expression:"{ELY4} > 0"},qe={name:"ELY5",type:"radiogroup",isRequired:!0,title:"Have you thought of dying or hurting yourselves in the past six months?",choices:[{text:"Not at all",value:0},{text:"Several days",value:1},{text:"More than half the days",value:2},{text:"Nearly every day",value:3}]},Ce={name:"qELY5_valid",expression:"{ELY5} > 0"},be={name:"ELY6",type:"radiogroup",isRequired:!0,title:"Have you seen a counsellor, psychologist, psychiatrist or other mental health professional, or General Practitioner for a mental health problem in the past six months?",choices:[{text:"No",value:0},{text:"Yes",value:1},{text:"Don't know",value:2}]},Pe={name:"qELY6_valid",expression:"{ELY6} == 0"},we={name:"description",type:"html",html:'<div class="utr-html-section"><h2>By providing your contact details, an account will be created for you, if you are eligible for the study.</h2><p>Your account will provide you with access to the Under the Radar study surveys, and periodic email notifications will be sent when surveys are available.</div>'},Ie={name:"preferredName",type:"text",isRequired:!0,title:"What is your preferred name?",inputType:"text",maxLength:128},Re={name:"email",type:"text",isRequired:!0,title:"What is your email address?",inputType:"email",maxLength:128},De={...W,pages:[{name:"Under the Radar",elements:[fe,_e,Ee,Se,qe,be]},{name:"Under the Radar",elements:[we,Ie,Re],visibleIf:"{__needContactPage} || ({eligible_for_study})"}],calculatedValues:[he,xe,Le,Ye,Ce,Pe,{name:"eligible_for_study",expression:"{qELY1_valid} && {qELY2_valid} && {qELY3_valid} && {qELY4_valid} && {qELY5_valid} && {qELY6_valid}",includeIntoResult:!0}]},ke=j("experiment",()=>{const o=u(null),a=s=>{o.value=s},l=()=>{o.value=null},i=Y(z),n=Y(le);return{setExperimentId:a,clearExperimentId:l,getESExperimentCached:i.cacheFn,getPCMExperimentCached:n.cacheFn}});const Me={},Ne=o=>(X("data-v-9ff2ffc3"),o=o(),J(),o),Te={class:"processing"},Be=Ne(()=>Q("h4",{class:"utr-text-h4"},"Processing. Please wait...",-1)),Fe=[Be];function He(o,a){return c(),q("div",Te,Fe)}const Oe=G(Me,[["render",He],["__scopeId","data-v-9ff2ffc3"]]),Ae={ref:"container",class:"eligibility-view"},ze=Z({__name:"EligibilityView",props:{experimentId:null},setup(o){const a=o,{loginWithRedirect:l}=ce(),i=K(),n=ee(),s=ue(),C=ke(),f=se(),h=u(),d=u(),_=u(),b=v(()=>De),p=v(()=>`eligibility:${a.experimentId}`),P=v(()=>i.processing);te(()=>{const e=A(p.value);_.value=e.oldData}),ae(async()=>{if(!s.acceptStudy){const e=a.experimentId?`/consent/${a.experimentId}`:"/consent-test";f.push({path:e})}try{a.experimentId&&await C.getPCMExperimentCached(a.experimentId)}catch(e){console.error(e),f.push({path:"/error-page"})}});function w(e){return!!e.eligible_for_study}function I(e){return e.ELY1>=18}function x(e){const t=e.email;if(t==null)return null;if(typeof t!="string")throw new Error("email is not a string");return t}function m(e){i.setSurveyCompleted(!0),d.value=e,h.value&&(h.value.scrollTop=0)}async function R(e){i.setProcessing(!0);try{const t=x(e),r=await D(e);m(r),t&&await l({appState:{target:"/user-home"},authorizationParams:{screen_hint:"signup",login_hint:t}})}catch(t){t instanceof ie?m("existing account"):m("error")}finally{i.setProcessing(!1),$(p.value)}}async function D(e){const t=w(e);if(!I(e))return"ineligible";const r={...e,accept_data_sharing:s.acceptDataSharing,accept_future_contact:s.acceptFutureContact,request_feedback:s.requestFeedback,consent:s.acceptStudy},F=await pe(a.experimentId),H=await me(a.experimentId);let E=await ge(a.experimentId,F.id,r);if(!E)return"no consent";const L=E.participantCandidateMappingId,g=x(e);if(await ve(L,H.id,g,t,e),!t||!g)return"ineligible";const O=await re(g);return await ye(L,O.id),"signed up"}function k(e){i.setSurveyCompleted(!1),n.setPageCount(e.pageCount),n.setPageTitle(e.currentPage.name),n.setPageIndex(e.currentPageNo),n.setShowProgressBar(!0);const t=s.requestFeedback||s.acceptFutureContact;e.setVariable("__needContactPage",t)}ne(()=>{n.setShowProgressBar(!1)});function M(e,t){n.setPageIndex(e),n.setPageTitle(t)}function N(e,t){const r={...e};delete r.eligible_for_study,U(p.value,r,t)}function T(){l({appState:{target:"/user-home"}})}function B(e){n.setHelpKey(e)}return(e,t)=>(c(),q("div",Ae,[d.value?(c(),y(de,{key:1,"completion-state":d.value,onOnLogin:T},null,8,["completion-state"])):(c(),y(V,{key:0,"survey-data":S(b),"initial-state":_.value,onOnComplete:R,onOnLoaded:k,onOnPageChanged:M,onOnPartialSend:N,onHelp:B},null,8,["survey-data","initial-state"])),S(P)?(c(),y(Oe,{key:2})):oe("",!0)],512))}});export{ze as default};
